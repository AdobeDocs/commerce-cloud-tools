"use strict";(self.webpackChunkcommerce_cloud_tools=self.webpackChunkcommerce_cloud_tools||[]).push([[7527],{9132:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return l},default:function(){return u}});var n=a(87462),o=a(45987),r=(a(35776),a(3905)),m=a(91515);const p=["components"],l={},d=(i="InlineAlert",function(e){return console.warn("Component "+i+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.mdx)("div",e)});var i;const s={_frontmatter:l},c=m.Z;function u(e){let{components:t}=e,a=(0,o.Z)(e,p);return(0,r.mdx)(c,(0,n.Z)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"code-testing"},"Code testing"),(0,r.mdx)("p",null,"In a Cloud Docker for Commerce development environment, you can use the integrated test suite in each ",(0,r.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/release-notes/cloud-tools-suite.html"},"Cloud Suite for Commerce")," package for application code testing."),(0,r.mdx)("h2",{id:"test-resources"},"Test resources"),(0,r.mdx)("p",null,"The test suites, which use the ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/codeception/codeception"},"Codeception testing framework for PHP"),", provide acceptance tests to validate code intended for contribution to Commerce Cloud package repositories."),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Acceptance tests")," are in the package ",(0,r.mdx)("inlineCode",{parentName:"li"},"src/Test/Functional/Acceptance")," folder."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Test configuration")," is the ",(0,r.mdx)("inlineCode",{parentName:"li"},"codeception.dist.yml")," file in the package folder.")),(0,r.mdx)("p",null,"Use the following table to access the files and available tests for each Cloud package. The links use the ",(0,r.mdx)("inlineCode",{parentName:"p"},"develop")," branch, so be sure to select the appropriate tag for your project:"),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Package"),(0,r.mdx)("th",{parentName:"tr",align:null},"Test configuration link"),(0,r.mdx)("th",{parentName:"tr",align:null},"Acceptance test link"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"ECE-tools"),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("a",{parentName:"td",href:"https://github.com/magento/ece-tools/blob/develop/codeception.dist.yml"},"codeception.dist.yml")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("a",{parentName:"td",href:"https://github.com/magento/ece-tools/tree/develop/src/Test/Functional/Acceptance"},"magento/ece-tools Acceptance tests"))),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"Cloud components"),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("a",{parentName:"td",href:"https://github.com/magento/magento-cloud-components/blob/develop/codeception.dist.yml"},"codeception.dist.yml")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("a",{parentName:"td",href:"https://github.com/magento/magento-cloud-components/tree/develop/Test/Functional/Acceptance"},"magento/magento-cloud-components Acceptance tests"))),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"Cloud Docker"),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("a",{parentName:"td",href:"https://github.com/magento/magento-cloud-docker/blob/develop/codeception.dist.yml"},"codeception.dist.yml")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("a",{parentName:"td",href:"https://github.com/magento/magento-cloud-docker/tree/develop/src/Test/Functional/Acceptance"},"magento/magento-cloud-docker Acceptance tests"))),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},"Cloud patches"),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("a",{parentName:"td",href:"https://github.com/magento/magento-cloud-patches/blob/develop/codeception.dist.yml"},"codeception.dist.yml")),(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("a",{parentName:"td",href:"https://github.com/magento/magento-cloud-patches/tree/develop/src/Test/Functional/Acceptance"},"magento/magento-cloud-patches Acceptance tests"))))),(0,r.mdx)(d,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"For application testing, use the Magento Application Testing (MFTF) framework to run functional tests. See ",(0,r.mdx)("a",{parentName:"p",href:"application-testing.md"},"Application testing"),"."),(0,r.mdx)("h2",{id:"prepare-the-docker-environment-for-testing"},"Prepare the Docker environment for testing"),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"To set up and configure the test environment"),":"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Clone the GitHub repository for the package to test."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"git clone git@github.com:magento/<cloud-suite-package-repository>.git\n")),(0,r.mdx)("p",{parentName:"li"},"For example, clone the ECE-Tools package:"),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"git clone git@github.com:magento/ece-tools.git\n"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Stop all services that use the following ports:"),(0,r.mdx)("ul",{parentName:"li"},(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"80"),"—varnish"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"443"),"—web, tls"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"3306"),"—Apache, mysql"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Add the following hostname to your ",(0,r.mdx)("inlineCode",{parentName:"p"},"/etc/hosts")," file."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-conf"},"127.0.0.1 magento2.docker\n")),(0,r.mdx)("p",{parentName:"li"},"Alternatively, you can run the following command to add it to the file:"),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},'echo "127.0.0.1 magento2.docker" | sudo tee -a /etc/hosts\n'))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Add required project dependencies if you are testing the following packages."),(0,r.mdx)("ul",{parentName:"li"},(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"For the ",(0,r.mdx)("inlineCode",{parentName:"p"},"magento/magento-cloud-patches")," package:"),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},'composer require "magento/magento-cloud-docker:^1.0.0" --no-update\n'))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},"For the ",(0,r.mdx)("inlineCode",{parentName:"p"},"magento/magento-cloud-components")," package:"),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},'composer require "magento/magento-cloud-docker:^1.0.0" --no-update\ncomposer require "magento/framework:*" --no-update\ncomposer require "magento/module-store:*" --no-update\ncomposer require "magento/module-url-rewrite:*" --no-update\n'))))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Switch to the preferred PHP version for running tests.")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Update the project dependencies."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"composer update\n")))),(0,r.mdx)("h3",{id:"add-credentials"},"Add credentials"),(0,r.mdx)("p",null,"Add credentials to your Docker environment using any of the following methods:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Use environment variables"),(0,r.mdx)("li",{parentName:"ul"},"Load credentials from the environment configuration file"),(0,r.mdx)("li",{parentName:"ul"},"Add variables directly to the test configuration file")),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"To add credentials using environment variables"),":"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Create environment variables for your GitHub authentication keys."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"export REPO_USERNAME=your_public_key\n")),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"export REPO_PASSWORD=your_private_key\n"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Some packages require a GitHub authentication during installation. Create an environment variable with your GitHub token that can be used to install these packages."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"`export GITHUB_TOKEN=your_github_token\n")))),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"To load credentials from the environment configuration file"),":"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Run the following commands to write credentials to the ",(0,r.mdx)("inlineCode",{parentName:"p"},"./.env")," file:"),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},'echo "REPO_USERNAME=your_public_key" >> ./.env\n')),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},'echo "REPO_PASSWORD=your_private_key" >> ./.env\n'))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Edit the ",(0,r.mdx)("inlineCode",{parentName:"p"},"codeception.dist.yml")," file."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-yaml"},"params:\n    - tests/functional/configuration.dist.yml\n    - env\n    - .env\n"))),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Add a dependency for the ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/vlucas/phpdotenv"},"vlucas/phpdotenv")," package required to load the environment variables."),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},'composer require "vlucas/phpdotenv": "^3.0"\n')))),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"To add credentials directly to the test configuration file"),":"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Open the ",(0,r.mdx)("inlineCode",{parentName:"p"},"codeception.dist.yml")," file in an editor.")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Replace the ",(0,r.mdx)("inlineCode",{parentName:"p"},"%REPO_USERNAME%"),", ",(0,r.mdx)("inlineCode",{parentName:"p"},"%REPO_PASSWORD%"),", and ",(0,r.mdx)("inlineCode",{parentName:"p"},"%GITHUB_TOKEN%")," placeholder values with your credentials:"),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-yaml"},'modules:\n  config:\n    Magento\\CloudDocker\\Test\\Functional\\Codeception\\TestInfrastructure:\n    ...\n    composer_magento_username: "%REPO_USERNAME%"\n    composer_magento_password: "%REPO_PASSWORD%"\n    composer_github_token: "%GITHUB_TOKEN%"\n      ...\n')))),(0,r.mdx)("h2",{id:"run-tests"},"Run tests"),(0,r.mdx)("p",null,"Before you run tests, you must prepare your Docker environment and update the test configuration file. See ",(0,r.mdx)("a",{parentName:"p",href:"#prepare-the-docker-environment-for-testing"},"Prepare the test environment"),". By default, functional tests produce a short output. You can receive more detailed output by editing the ",(0,r.mdx)("inlineCode",{parentName:"p"},"codeception.dist.yml")," test configuration file to set the ",(0,r.mdx)("inlineCode",{parentName:"p"},"printOutput:")," property to ",(0,r.mdx)("inlineCode",{parentName:"p"},"true"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-yaml"},"modules:\n  config:\n    Magento\\CloudDocker\\Test\\Functional\\Codeception\\TestInfrastructure:\n      ...\n      printOutput: true\n      ...\n    Magento\\CloudDocker\\Test\\Functional\\Codeception\\Docker:\n      ...\n      printOutput: true\n      ...\n")),(0,r.mdx)(d,{variant:"help",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"You can locate the test configuration file in the root directory for each package. See ",(0,r.mdx)("a",{parentName:"p",href:"#test-resources"},"Test resources"),"."),(0,r.mdx)("h3",{id:"run-a-specific-test"},"Run a specific test"),(0,r.mdx)("p",null,"Use the following command format to run a specific functional test:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"./vendor/bin/codecept run Acceptance <TestName>Cest\n")),(0,r.mdx)("p",null,"For example, the following test for ",(0,r.mdx)("inlineCode",{parentName:"p"},"magento/ece-tools")," code verifies that the post-deploy task runs successfully."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"./vendor/bin/codecept run Acceptance PostDeployCest\n")),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Sample response:")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-terminal"},'Codeception PHP Testing Framework v2.5.6\nPowered by PHPUnit 6.5.14 by Sebastian Bergmann and contributors.\nRunning with seed:\nAcceptance Tests (1) -----------------------------------------------------------------------------------------------\n--------------------------------------------------------------------------------------------------------------------\n-------------------------------------------------------------------------------\nPostDeployCest: Test post deploy | {"ADMIN_EMAIL":"admin@example.com"}\n [Magento\\MagentoCloud\\Test\\Functional\\Robo\\Tasks\\GenerateDockerCompose] Running ./bin/ece-docker build:compose\n --mode=functional --php=7.2\n...\n...\n✔ PostDeployCest: Test post deploy | {"ADMIN_EMAIL":"admin@example.com"} (210.41s)\n')),(0,r.mdx)(d,{variant:"help",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"You can see the available tests for each package in the package source files. See ",(0,r.mdx)("a",{parentName:"p",href:"#test-resources"},"Test resources"),"."),(0,r.mdx)("h3",{id:"run-all-tests"},"Run all tests"),(0,r.mdx)("p",null,"Use the following commands to run all available tests for each PHP version:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("strong",{parentName:"p"},"PHP 7.1")),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"./vendor/bin/codecept run -g php71 --steps\n"))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("strong",{parentName:"p"},"PHP 7.2")),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"./vendor/bin/codecept run -g php72 --steps\n"))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("strong",{parentName:"p"},"PHP 7.3")),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"./vendor/bin/codecept run -g php73 --steps\n"))),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("p",{parentName:"li"},(0,r.mdx)("strong",{parentName:"p"},"PHP 7.4")),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"./vendor/bin/codecept run -g php74 --steps\n")),(0,r.mdx)("p",{parentName:"li"},"If you are testing ",(0,r.mdx)("inlineCode",{parentName:"p"},"magento/ece-tools")," code, use the following command:"),(0,r.mdx)("pre",{parentName:"li"},(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"./vendor/bin/codecept run -x php71 -x php72 -x php73 -x php74 --steps\n")))),(0,r.mdx)(d,{variant:"help",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"For help with Codeception command options, use the ",(0,r.mdx)("inlineCode",{parentName:"p"},".vendor/bin/codecept run --help")," command, or see the ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/Codeception/Codeception/blob/2.5/src/Codeception/Command/Run.php"},"Codeception CLI documentation")," for the installed version."))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-docker-test-code-testing-md-b0ed461453104c53e0b4.js.map